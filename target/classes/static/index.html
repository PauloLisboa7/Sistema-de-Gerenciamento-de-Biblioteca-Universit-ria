<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Biblioteca Universitária</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
    <div class="container mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8">Sistema de Gerenciamento de Biblioteca Universitária</h1>

        <!-- Seção de Livros -->
        <div class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">Livros</h2>
            <button onclick="carregarLivros()" class="bg-blue-500 text-white px-4 py-2 rounded mb-4">Carregar Livros</button>
            <div id="livros-lista" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            <div id="form-livro" class="hidden mt-4">
                <h3 class="text-xl mb-2">Adicionar/Editar Livro</h3>
                <form onsubmit="salvarLivro(event)">
                    <input type="hidden" id="livro-id">
                    <input type="text" id="titulo" placeholder="Título" required class="border p-2 mb-2 w-full">
                    <input type="text" id="autor" placeholder="Autor" required class="border p-2 mb-2 w-full">
                    <input type="number" id="ano" placeholder="Ano" required class="border p-2 mb-2 w-full">
                    <input type="text" id="isbn" placeholder="ISBN" required class="border p-2 mb-2 w-full">
                    <select id="disponivel" class="border p-2 mb-2 w-full">
                        <option value="true">Disponível</option>
                        <option value="false">Emprestado</option>
                    </select>
                    <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded">Salvar</button>
                    <button type="button" onclick="cancelarEdicao()" class="bg-gray-500 text-white px-4 py-2 rounded ml-2">Cancelar</button>
                </form>
            </div>
        </div>

        <!-- Seção de Usuários -->
        <div class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">Usuários</h2>
            <button onclick="carregarUsuarios()" class="bg-blue-500 text-white px-4 py-2 rounded mb-4">Carregar Usuários</button>
            <div id="usuarios-lista" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            <div id="form-usuario" class="hidden mt-4">
                <h3 class="text-xl mb-2">Adicionar/Editar Usuário</h3>
                <form onsubmit="salvarUsuario(event)">
                    <input type="hidden" id="usuario-id">
                    <input type="text" id="nome" placeholder="Nome" required class="border p-2 mb-2 w-full">
                    <input type="text" id="matricula" placeholder="Matrícula" required class="border p-2 mb-2 w-full">
                    <input type="text" id="curso" placeholder="Curso" required class="border p-2 mb-2 w-full">
                    <input type="email" id="email" placeholder="E-mail" required class="border p-2 mb-2 w-full">
                    <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded">Salvar</button>
                    <button type="button" onclick="cancelarEdicaoUsuario()" class="bg-gray-500 text-white px-4 py-2 rounded ml-2">Cancelar</button>
                </form>
            </div>
        </div>

        <!-- Seção de Empréstimos -->
        <div class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">Empréstimos</h2>
            <button onclick="carregarEmprestimos()" class="bg-blue-500 text-white px-4 py-2 rounded mb-4">Carregar Empréstimos</button>
            <div id="emprestimos-lista" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            <div id="form-emprestimo" class="hidden mt-4">
                <h3 class="text-xl mb-2">Registrar Empréstimo</h3>
                <form onsubmit="salvarEmprestimo(event)">
                    <input type="hidden" id="emprestimo-id">
                    <select id="usuario-emprestimo" required class="border p-2 mb-2 w-full">
                        <option value="">Selecione Usuário</option>
                    </select>
                    <select id="livro-emprestimo" required class="border p-2 mb-2 w-full">
                        <option value="">Selecione Livro</option>
                    </select>
                    <input type="date" id="data-emprestimo" required class="border p-2 mb-2 w-full">
                    <input type="date" id="data-devolucao" class="border p-2 mb-2 w-full">
                    <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded">Salvar</button>
                    <button type="button" onclick="cancelarEdicaoEmprestimo()" class="bg-gray-500 text-white px-4 py-2 rounded ml-2">Cancelar</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api';

        // Funções para Livros
        async function carregarLivros() {
            const response = await fetch(`${API_BASE}/livros`);
            const livros = await response.json();
            const lista = document.getElementById('livros-lista');
            lista.innerHTML = livros.map(livro => `
                <div class="bg-white p-4 rounded shadow">
                    <h3 class="font-bold">${livro.titulo}</h3>
                    <p>Autor: ${livro.autor}</p>
                    <p>Ano: ${livro.ano}</p>
                    <p>ISBN: ${livro.isbn}</p>
                    <p>Disponível: ${livro.disponivel ? 'Sim' : 'Não'}</p>
                    <button onclick="editarLivro(${livro.id})" class="bg-yellow-500 text-white px-2 py-1 rounded mr-2">Editar</button>
                    <button onclick="deletarLivro(${livro.id})" class="bg-red-500 text-white px-2 py-1 rounded">Deletar</button>
                </div>
            `).join('');
        }

        function mostrarFormLivro() {
            document.getElementById('form-livro').classList.remove('hidden');
        }

        function editarLivro(id) {
            fetch(`${API_BASE}/livros/${id}`)
                .then(response => response.json())
                .then(livro => {
                    document.getElementById('livro-id').value = livro.id;
                    document.getElementById('titulo').value = livro.titulo;
                    document.getElementById('autor').value = livro.autor;
                    document.getElementById('ano').value = livro.ano;
                    document.getElementById('isbn').value = livro.isbn;
                    document.getElementById('disponivel').value = livro.disponivel.toString();
                    mostrarFormLivro();
                });
        }

        async function salvarLivro(event) {
            event.preventDefault();
            const id = document.getElementById('livro-id').value;
            const livro = {
                titulo: document.getElementById('titulo').value,
                autor: document.getElementById('autor').value,
                ano: parseInt(document.getElementById('ano').value),
                isbn: document.getElementById('isbn').value,
                disponivel: document.getElementById('disponivel').value === 'true'
            };
            const method = id ? 'PUT' : 'POST';
            const url = id ? `${API_BASE}/livros/${id}` : `${API_BASE}/livros`;
            await fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(livro)
            });
            cancelarEdicao();
            carregarLivros();
        }

        async function deletarLivro(id) {
            await fetch(`${API_BASE}/livros/${id}`, { method: 'DELETE' });
            carregarLivros();
        }

        function cancelarEdicao() {
            document.getElementById('form-livro').classList.add('hidden');
            document.getElementById('livro-id').value = '';
            document.getElementById('titulo').value = '';
            document.getElementById('autor').value = '';
            document.getElementById('ano').value = '';
            document.getElementById('isbn').value = '';
        }

        // Funções para Usuários (similar às de livros)
        async function carregarUsuarios() {
            const response = await fetch(`${API_BASE}/usuarios`);
            const usuarios = await response.json();
            const lista = document.getElementById('usuarios-lista');
            lista.innerHTML = usuarios.map(usuario => `
                <div class="bg-white p-4 rounded shadow">
                    <h3 class="font-bold">${usuario.nome}</h3>
                    <p>Matrícula: ${usuario.matricula}</p>
                    <p>Curso: ${usuario.curso}</p>
                    <p>E-mail: ${usuario.email}</p>
                    <button onclick="editarUsuario(${usuario.id})" class="bg-yellow-500 text-white px-2 py-1 rounded mr-2">Editar</button>
                    <button onclick="deletarUsuario(${usuario.id})" class="bg-red-500 text-white px-2 py-1 rounded">Deletar</button>
                </div>
            `).join('');
        }

        function mostrarFormUsuario() {
            document.getElementById('form-usuario').classList.remove('hidden');
        }

        function editarUsuario(id) {
            fetch(`${API_BASE}/usuarios/${id}`)
                .then(response => response.json())
                .then(usuario => {
                    document.getElementById('usuario-id').value = usuario.id;
                    document.getElementById('nome').value = usuario.nome;
                    document.getElementById('matricula').value = usuario.matricula;
                    document.getElementById('curso').value = usuario.curso;
                    document.getElementById('email').value = usuario.email;
                    mostrarFormUsuario();
                });
        }

        async function salvarUsuario(event) {
            event.preventDefault();
            const id = document.getElementById('usuario-id').value;
            const usuario = {
                nome: document.getElementById('nome').value,
                matricula: document.getElementById('matricula').value,
                curso: document.getElementById('curso').value,
                email: document.getElementById('email').value
            };
            const method = id ? 'PUT' : 'POST';
            const url = id ? `${API_BASE}/usuarios/${id}` : `${API_BASE}/usuarios`;
            await fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(usuario)
            });
            cancelarEdicaoUsuario();
            carregarUsuarios();
        }

        async function deletarUsuario(id) {
            await fetch(`${API_BASE}/usuarios/${id}`, { method: 'DELETE' });
            carregarUsuarios();
        }

        function cancelarEdicaoUsuario() {
            document.getElementById('form-usuario').classList.add('hidden');
            document.getElementById('usuario-id').value = '';
            document.getElementById('nome').value = '';
            document.getElementById('matricula').value = '';
            document.getElementById('curso').value = '';
            document.getElementById('email').value = '';
        }

        // Funções para Empréstimos
        async function carregarEmprestimos() {
            const response = await fetch(`${API_BASE}/emprestimos`);
            const emprestimos = await response.json();
            const lista = document.getElementById('emprestimos-lista');
            lista.innerHTML = emprestimos.map(emprestimo => `
                <div class="bg-white p-4 rounded shadow">
                    <p>Usuário: ${emprestimo.usuario.nome}</p>
                    <p>Livro: ${emprestimo.livro.titulo}</p>
                    <p>Data Empréstimo: ${emprestimo.dataEmprestimo}</p>
                    <p>Data Devolução: ${emprestimo.dataDevolucao || 'Não devolvido'}</p>
                    <button onclick="editarEmprestimo(${emprestimo.id})" class="bg-yellow-500 text-white px-2 py-1 rounded mr-2">Editar</button>
                    <button onclick="deletarEmprestimo(${emprestimo.id})" class="bg-red-500 text-white px-2 py-1 rounded">Deletar</button>
                </div>
            `).join('');
        }

        function mostrarFormEmprestimo() {
            document.getElementById('form-emprestimo').classList.remove('hidden');
            carregarUsuariosParaSelect();
            carregarLivrosParaSelect();
        }

        async function carregarUsuariosParaSelect() {
            const response = await fetch(`${API_BASE}/usuarios`);
            const usuarios = await response.json();
            const select = document.getElementById('usuario-emprestimo');
            select.innerHTML = '<option value="">Selecione Usuário</option>' + usuarios.map(u => `<option value="${u.id}">${u.nome}</option>`).join('');
        }

        async function carregarLivrosParaSelect() {
            const response = await fetch(`${API_BASE}/livros`);
            const livros = await response.json();
            const select = document.getElementById('livro-emprestimo');
            select.innerHTML = '<option value="">Selecione Livro</option>' + livros.filter(l => l.disponivel).map(l => `<option value="${l.id}">${l.titulo}</option>`).join('');
        }

        function editarEmprestimo(id) {
            fetch(`${API_BASE}/emprestimos/${id}`)
                .then(response => response.json())
                .then(emprestimo => {
                    document.getElementById('emprestimo-id').value = emprestimo.id;
                    document.getElementById('usuario-emprestimo').value = emprestimo.usuario.id;
                    document.getElementById('livro-emprestimo').value = emprestimo.livro.id;
                    document.getElementById('data-emprestimo').value = emprestimo.dataEmprestimo;
                    document.getElementById('data-devolucao').value = emprestimo.dataDevolucao || '';
                    mostrarFormEmprestimo();
                });
        }

        async function salvarEmprestimo(event) {
            event.preventDefault();
            const id = document.getElementById('emprestimo-id').value;
            const emprestimo = {
                usuario: { id: parseInt(document.getElementById('usuario-emprestimo').value) },
                livro: { id: parseInt(document.getElementById('livro-emprestimo').value) },
                dataEmprestimo: document.getElementById('data-emprestimo').value,
                dataDevolucao: document.getElementById('data-devolucao').value || null
            };
            const method = id ? 'PUT' : 'POST';
            const url = id ? `${API_BASE}/emprestimos/${id}` : `${API_BASE}/emprestimos`;
            await fetch(url, {
                method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(emprestimo)
            });
            cancelarEdicaoEmprestimo();
            carregarEmprestimos();
        }

        async function deletarEmprestimo(id) {
            await fetch(`${API_BASE}/emprestimos/${id}`, { method: 'DELETE' });
            carregarEmprestimos();
        }

        function cancelarEdicaoEmprestimo() {
            document.getElementById('form-emprestimo').classList.add('hidden');
            document.getElementById('emprestimo-id').value = '';
            document.getElementById('usuario-emprestimo').value = '';
            document.getElementById('livro-emprestimo').value = '';
            document.getElementById('data-emprestimo').value = '';
            document.getElementById('data-devolucao').value = '';
        }

        // Inicializar
        window.onload = () => {
            carregarLivros();
            carregarUsuarios();
            carregarEmprestimos();
        };
    </script>
</body>
</html>
